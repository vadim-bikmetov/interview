## Ansible basic
<img src="https://raw.githubusercontent.com/vadim-bikmetov/interview/main/images/ansible.png" width="200" alt="Ansible">
1. Чем отличаются Ansible модули *raw*, *command* и *shell*?

<details>
  <summary>Ответ</summary>

Модуль *raw* отличается от *command* и *shell* тем, что не выполняет дополнительную обработку выполнения команды. Эти дополнительные обработки присутствуют в почти любом модуле Ansible. Модуль *raw* передает команду, как есть, в "сыром" (raw) виде без проверок.
Модули *command* и *shell* отличаются тем, что в модуле *command* команда выполняется без прохождения через командную оболочку `/bin/sh`. Поэтому переменные определенные в оболочке и перенаправления - конвееры работать не будут. Модуль *shell* выполняет команды через оболочку по умолчанию `/bin/sh`. Поэтому там будут доступны переменные оболочки и перенаправления.

</details>

---

2. На всех серверах должен быть набор пользователей, с доступом по ssh-ключу, стандартный модуль user не позволяет вносить ssh ключ в authorized_keys. Предложите решение.

<details>
  <summary>Ответ</summary>

1. Использовать модуль `authorized_key` для добавления ключей.
2. Использовать модуль `shell`, чтобы вручную с использованием команды `cat {{ PUBLIC_SSH_KEY }} >> /home/{{ USER }}/.ssh/authorized_keys` добавить ключ. В данном случае шаблоны Jinja2 PUBLIC_SSH_KEY и USER должны быть заданы.

</details>

---

3. Есть группы пользователей, которые должны заводиться не на всех серверах. Как ограничить заведение пользователей?

<details>
  <summary>Ответ</summary>

Сгруппировать сервера, на которых должны заводиться группы пользователей, в инвентори или написать в плейбуке условие, которому передаётся список серверов, на которых необходимо выполнить задачу.

</details>

---

4. На новом сервере не установлен Python, который требуется для работы Ansible. Как выполнить установку Python на сервере используя Ansible?

<details>
  <summary>Ответ</summary>

Использовать модуль `raw`, которому необходимо передать команду для установки python на сервере. Модуль `raw` принимает команду без дополнительной обработки Python и выполняет её на сервере.

</details>

---

5. Что такое роль в Ansible? Что содержит в себе Ansible роль?

<details>
  <summary>Ответ</summary>

Ansible роль представляет собой структурированный плейбук, содержащий, как минимум, набор задач (tasks) и дополнительно - обработчики событий (handlers), переменных (default и vars), файлов (files), шаблонов (templates), описание и зависимости (metadata) и тесты (tests).

</details>

---

6. В Ansible роли есть директории *vars* и *default*. Что они содержат и чем отличаются?

<details>
  <summary>Ответ</summary>

Ansible применяет порядок приоритета переменных. Ниже представлен список в порядке повышения приоритета.

1. command line values (for example, -u my_user, these are not variables)
2. role defaults (defined in role/defaults/main.yml)
3. inventory file or script group vars
4. inventory group_vars/all
5. playbook group_vars/all
6. inventory group_vars/*
7. playbook group_vars/*
8. inventory file or script host vars
9. inventory host_vars/*
10. playbook host_vars/*
11. host facts / cached set_facts
12. play vars
13. play vars_prompt
14. play vars_files
15. role vars (определяемые в role/vars/main.yml)
16. block vars (только для задач в `block`)
17. task vars (только для задач)
18. include_vars
19. set_facts / registered vars
20. role (и include_role) params
21. include params
22. extra vars (например, -e "user=my_user")(всегда приоритетнее)

Соответственно переменные в *vars* будут приорететнее, чем в *defaults*.

</details>

---

7. В Ansible роли есть директории *file* и *templates*. Что они содержат и чем отличаются?

<details>
  <summary>Ответ</summary>

*files* - содержит файлы, которые будут скопированы на настраиваемые хосты; так же — может содержать скрипты, которые позже будут запускаться на хостах.

*templates* - содержит шаблоны файлов с переменными.

</details>

---

8. По-умолчанию, в Ansible все задачи из списка выполняются параллельно на всех хостах, которые указаны в `hosts`. Как сделать так, чтобы задачи выполнялись последовательно по хостам?

<details>
  <summary>Ответ</summary>

Необходимо установить параметр `serial: 1`, чтобы определить количество хостов, на которых будут выполняться паралелльно задачи. Значение 1 будет значить, что все задачи будут проходить параллельно по 1 хосту за раз.

Ссылка на документацию: https://docs.ansible.com/ansible/latest/user_guide/playbooks_strategies.html#setting-the-batch-size-with-serial

</details>

---


9. Что такое Ansible и как он работает?
<details>
  <summary>Ответ</summary>

Ansible — это платформа автоматизации с открытым исходным кодом, используемая для управления конфигурацией, развертывания приложений и автоматизации задач. Она работает путем подключения к удаленным хостам по SSH и выполнения задач, определенных в файлах YAML.
</details>

---

10. Что такое плейбук Ansible?
<details>
  <summary>Ответ</summary>

Playbooks — это файлы YAML, которые определяют ряд задач и конфигураций, которые будут выполняться на удаленных хостах. Они лежат в основе Ansible automation и обеспечивают структурированный способ определения рабочих процессов автоматизации.
</details>

---

11. Объясните разницу между Ansible и другими инструментами управления конфигурацией, такими как Puppet и Chef.
<details>
  <summary>Ответ</summary>

Хотя Ansible, Puppet и Chef являются инструментами управления конфигурацией, Ansible не имеет агентов и использует SSH для связи, что упрощает его настройку и использование по сравнению с Puppet и Chef, которые требуют установки агентов на управляемых узлах.
</details>

---

12. Что такое роль Ansible?
<details>
  <summary>Ответ</summary>

Роль Ansible — это набор задач, шаблонов и файлов переменных, структурированных для повторного использования. Роли помогают организовывать контент автоматизации в разных проектах и совместно использовать его.
</details>

---

13. Как вы устанавливаете Ansible в системе Linux?
<details>
  <summary>Ответ</summary>

Ansible можно установить в системах Linux с помощью менеджеров пакетов, таких как apt, yum, или с помощью Python's pip. Например, в Ubuntu вы можете использовать `sudo apt-get install ansible`.
</details>

---

14. Что такое файл инвентаризации Ansible и как он используется?
<details>
  <summary>Ответ</summary>

В файле инвентаризации Ansible перечислены хосты и группы хостов, которыми может управлять Ansible. Он служит источником достоверной информации для Ansible, позволяющей узнать, к каким хостам подключаться и выполнять задачи.
</details>

---

15. Как вы можете определять переменные в плейбуках Ansible?
<details>
  <summary>Ответ</summary>

Переменные в плейбуках Ansible могут быть определены различными способами, в том числе в самих плейбуках, в файлах инвентаря или во внешних файлах переменных. Они позволяют настраивать поведение плейбуков.
</details>

---

16. Что такое Ansible Galaxy?
<details>
  <summary>Ответ</summary>

Ansible Galaxy — это хранилище для совместного использования ролей Ansible. Оно позволяет пользователям находить, загружать и использовать готовые роли Ansible, созданные сообществом.
</details>

---

17. Объясните цель Ansible facts.
<details>
  <summary>Ответ</summary>

Факты Ansible — это фрагменты информации об удаленных хостах, которые Ansible собирает автоматически. Они предоставляют подробную информацию об окружении хоста, такую как аппаратное обеспечение, операционная система и конфигурация сети, и могут быть использованы в плейбуках.
</details>

---

18. Как вы можете защитить конфиденциальные данные, такие как пароли, в плейбуках Ansible?
<details>
  <summary>Ответ</summary>

Конфиденциальные данные могут быть защищены в плейбуках Ansible playbooks с помощью Ansible Vault, инструмента, который шифрует переменные и файлы, содержащие конфиденциальную информацию.
</details>

---

19. Что такое идемпотентность в Ansible и почему это важно?
<details>
  <summary>Ответ</summary>

Идемпотентность означает, что многократный запуск Ansible playbook приведет к тому же результату, что и его однократный запуск. Это важно, поскольку гарантирует безопасный запуск плейбуков без внесения непреднамеренных изменений.
</details>

---

20. Как перезапустить службу с помощью Ansible?
<details>
  <summary>Ответ</summary>

Вы можете использовать сервис или модуль systemd в Ansible для перезапуска сервиса на управляемых хостах. Например, `ansible-playbook -i inventory.ini playbook.yml -e "имя_службы=my_service state=перезапущен"`.
</details>

---

21. Что такое специальная команда Ansible?
<details>
  <summary>Ответ</summary>

Специальные команды используются для выполнения быстрых разовых задач на удаленных хостах без написания руководства по выполнению. Они выполняются с помощью команды ansible, такой как `ansible all -i inventory.ini -m ping`.
</details>

---

22. Объясните использование ролей в Ansible.
<details>
  <summary>Ответ</summary>

Роли в Ansible помогают организовать и структурировать код автоматизации. Они позволяют группировать задачи, шаблоны и переменные, связанные с определенной ролью или функцией, упрощая управление и повторное использование логики автоматизации.
</details>

---

23. Как вы можете отлаживать плейбуки Ansible?
<details>
  <summary>Ответ</summary>

Ansible предоставляет различные варианты отладки, включая использование модуля debug, включение детализации с помощью `-vvv` или использование ansible-playbook с флагом `--step` для выполнения задач по одной за раз.
</details>

---

24. Какова цель инструмента Ansible Tower (AWX)?
<details>
  <summary>Ответ</summary>

Ansible Tower, также известная как AWX, представляет собой веб-интерфейс и инструмент автоматизации, который предоставляет такие функции, как управление доступом на основе ролей, планирование заданий и панель мониторинга для управления Ansible automation.
</details>

---

25. Как вы справляетесь с различными средами (например, разработкой, промежуточным размещением, продакшеном) в Ansible?
<details>
  <summary>Ответ</summary>

В Ansible можно управлять различными средами, используя файлы инвентаризации, специфичные для каждой среды, и переменные Ansible для настройки плейбуков для каждой среды.
</details>

---

26. Объясните разницу между режимами push и pull в Ansible.
<details>
  <summary>Ответ</summary>

Режим Push включает в себя запуск плейбуков Ansible с управляющего узла и передачу изменений конфигурации управляемым узлам. Режим Pull, с другой стороны, предполагает, что управляемые узлы периодически извлекают плейбуки и выполняют их.
</details>

---

27. Что такое модули Ansible и почему они важны?
<details>
  <summary>Ответ</summary>

Модули Ansible — это автономные скрипты, которые Ansible использует для выполнения задач на управляемых узлах. Они важны, поскольку абстрагируют лежащие в основе системные различия и обеспечивают согласованный интерфейс для автоматизации.
</details>

---

28. Как вы можете гарантировать, что Ansible выполняет задачи параллельно?
<details>
  <summary>Ответ</summary>

Для параллельного выполнения задач вы можете использовать параметр командной строки `--forks` при запуске ansible-playbook. Кроме того, вы можете задать параметр конфигурации forks в файле конфигурации Ansible.
</details>

---

29. Какова цель инструкции о включении в плейбуках Ansible?
<details>
  <summary>Ответ</summary>

Инструкция include в Ansible playbooks позволяет включать другие файлы, playbooks или роли, упрощая модульность и повторное использование логики автоматизации.
</details>

---

30. Как вы можете обновить роли Ansible в Ansible Galaxy?
<details>
  <summary>Ответ</summary>

Вы можете обновить роли Ansible из Ansible Galaxy, используя команду ansible-galaxy с параметром `--force`, например, `ansible-galaxy install -f username.rolename`.
</details>

---

31. В чем разница между Ansible и Ansible Tower?
<details>
  <summary>Ответ</summary>

Ansible — это платформа автоматизации с открытым исходным кодом, в то время как Ansible Tower (или AWX) — корпоративная версия, предоставляющая дополнительные функции, такие как веб-интерфейс, планирование заданий и управление доступом на основе ролей.
</details>

---

32. Как вы управляете зависимостями между задачами в плейбуках Ansible?
<details>
  <summary>Ответ</summary>

Вы можете управлять зависимостями задач в плейбуках Ansible playbooks, используя ключевые слова, такие как depends_on, when, или структурируя плейбуки, чтобы гарантировать выполнение задач в нужном порядке.
</details>

---

33. Может ли Ansible управлять серверами и рабочими станциями Windows?
<details>
  <summary>Ответ</summary>

Да, Ansible может управлять серверами и рабочими станциями Windows с помощью специфичных для Windows модулей и сценариев PowerShell для задач автоматизации в системах Windows.
</details>

---
